<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>FTN Degenerator tool | VoiceProcess</title>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
    <!-- Bootstrap 3.3.2 -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />    
    <!-- FontAwesome 4.3.0 -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <!-- Ionicons 2.0.0 -->
    <link href="http://code.ionicframework.com/ionicons/2.0.0/css/ionicons.min.css" rel="stylesheet" type="text/css" />    
    <!-- Theme style -->
    <link href="dist/css/AdminLTE.min.css" rel="stylesheet" type="text/css" />
    <!-- AdminLTE Skins. Choose a skin from the css/skins 
         folder instead of downloading all of them to reduce the load. -->
    <link href="dist/css/skins/_all-skins.min.css" rel="stylesheet" type="text/css" />
    <!-- iCheck -->
   
    <!-- bootstrap wysihtml5 - text editor -->
    <link href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" rel="stylesheet" type="text/css" />
	<link href="style.css" rel="stylesheet" type="text/css" />
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
     
    <script src="angular.js"></script>
    
    	<script src="jquery.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/2.0.5/wavesurfer.min.js"></script>
      <script src="https://code.highcharts.com/stock/highstock.src.js"></script>
<script src="https://rawgithub.com/pablojim/highcharts-ng/master/src/highcharts-ng.js"></script>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
      <script src="voiceController.js"></script>
      
      <script src="uploadService1.js"></script>
     
  </head>
  <body class="skin-blue" ng-app="app1" >
 <div  id="plsRadi" ng-controller="voiceController" >


    <div class="wrapper">
      
      <header class="main-header">
        <!-- Logo -->
        <p class="logo"><b>FTN</b>VoiceTool</p>
        <!-- Header Navbar: style can be found in header.less -->
        <nav class="navbar navbar-static-top" role="navigation">
          <!-- Sidebar toggle button-->
          <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
            <span class="sr-only">Toggle navigation</span>
          </a>
          <div class="navbar-custom-menu">
            <ul class="nav navbar-nav">
            </ul>
          </div>
        </nav>
      </header>
      <!-- Left side column. contains the logo and sidebar -->
      <aside class="main-sidebar">
        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">
          <!-- Sidebar user panel -->
          <div class="user-panel">
            <div class="pull-left image">
              <img src="dist/img/studentImage.png" class="img-circle" alt="User Image" />
            </div>
            <div class="pull-left info">
              <p>Dobrodosli</p>
            </div>
          </div>
          <!-- search form -->
          <form action="#" method="get" class="sidebar-form">
            <div class="input-group">
              <input type="text" name="q" class="form-control" placeholder="Search..."/>
              <span class="input-group-btn">
                <button type='submit' name='search' id='search-btn' class="btn btn-flat" width="3em"><i class="fa fa-search"></i></button>
              </span>
            </div>
          </form>
          <!-- /.search form -->
          <!-- sidebar menu: : style can be found in sidebar.less -->
          <ul class="sidebar-menu">
            <li class="header">Navigacija</li>
            <li class="active treeview">
              <a href="#">
                <i class="fa fa-dashboard"></i> <span>Kontrolna tabla</span> <i class="fa fa-angle-left pull-right"></i>
              </a>
              <ul class="treeview-menu">
                <li><a href="index.html"><i class="fa fa-circle-o"></i> Pocetna</a></li>
                <li><a href="about.html"><i class="fa fa-circle-o"></i> O nama</a></li>
				<li><a href="help.html"><i class="fa fa-circle-o"></i> Pomoc</a></li>
				<li><a href="contact.html"><i class="fa fa-circle-o"></i> Kontakt</a></li>
              </ul>
            </li>
            <li class="treeview">
              <a href="#">
                <i class="fa fa-files-o"></i>
                <span>Funkcije</span>
                <span class="label label-primary pull-right">6</span>
              </a>
              <ul class="treeview-menu">
                <li class="active"><a href="voiceToTextLive.html"><i class="fa fa-circle-o"></i> Audio u tekst uzivo</a></li>
                <li><a href="voiceProc.html"><i class="fa fa-circle-o"></i> Audio obrada</a></li>
				<li><a href="videoProc.html"><i class="fa fa-circle-o"></i> Video obrada</a></li>
                <li><a href="textProc.html"><i class="fa fa-circle-o"></i> Text obrada</a></li>
				<li><a href="voiceStream.html"><i class="fa fa-circle-o"></i> Audio prenos</a></li>
				<li><a href="videoStream.html"><i class="fa fa-circle-o"></i> Video prenos</a></li>
              </ul>
            </li>
            
            <span id="wtfGrba_sramotSpan" ng-hide=""></span>
            <li class="treeview">
              <a href="#">
                <i class="fa fa-share"></i> <span>FTN</span>
                <i class="fa fa-angle-left pull-right"></i>
              </a>
              <ul class="treeview-menu">
                <li><a href="#"><i class="fa fa-circle-o"></i> Odsek1</a></li>
                <li>
                  <a href="#"><i class="fa fa-circle-o"></i> Odsek2 <i class="fa fa-angle-left pull-right"></i></a>
                  <ul class="treeview-menu">
                    <li><a href="#"><i class="fa fa-circle-o"></i> Smer1</a></li>
                    <li>
                      <a href="#"><i class="fa fa-circle-o"></i> Smer2 <i class="fa fa-angle-left pull-right"></i></a>
                      <ul class="treeview-menu">
                        <li><a href="#"><i class="fa fa-circle-o"></i> Predmet1</a></li>
                        <li><a href="#"><i class="fa fa-circle-o"></i> Predmet2</a></li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><a href="#"><i class="fa fa-circle-o"></i> Odsek3</a></li>
              </ul>
            </li>
            <li><a href="documentation/index.html"><i class="fa fa-book"></i> Dokumentacija</a></li>
          </ul>
        </section>
        <!-- /.sidebar -->
      </aside>

      <!-- Right side column. Contains the navbar and content of the page -->
      <div class="content-wrapper"
	  style = "
  * {
    font-family: Verdana, Arial, sans-serif;
  }
  a:link {
    color:#000;
    text-decoration: none;
  }
  a:visited {
    color:#000;
  }
  a:hover {
    color:#33F;
  }
  .button {
    background: -webkit-linear-gradient(top,#008dfd 0,#0370ea 100%);
    border: 1px solid #076bd2;
    border-radius: 3px;
    color: #fff;
    display: none;
    font-size: 13px;
    font-weight: bold;
    line-height: 1.3;
    padding: 8px 25px;
    text-align: center;
    text-shadow: 1px 1px 1px #076bd2;
    letter-spacing: normal;
  }
  
  .center {
    padding: 10px;
    text-align: center;
  }
  .final {
    color: black;
    padding-right: 3px; 
  }
  .interim {
    color: gray;
  }
  .info {
    font-size: 14px;
    text-align: center;
    color: #777;
    display: none;
  }
  .right {
    float: right;
  }
  .sidebyside {
    display: inline-block;
    width: 45%;
    min-height: 40px;
    text-align: left;
    vertical-align: top;
  }
  #headline {
    font-size: 40px;
    font-weight: 300;
  }
  #info {
    font-size: 20px;
    text-align: center;
    color: #777;
    visibility: hidden;
  }
  #results {
    font-size: 14px;
    font-weight: bold;
    border: 1px solid #ddd;
    padding: 15px;
    text-align: left;
    min-height: 150px;
  }
  #start_button {
    border: 0;
    background-color:transparent;
    padding: 0;
  }
  p{
		font-family: Arial;
	font-size: 16;
  }
	  "
	  >
        <!-- Main content -->
        <section class="content">
         <h3>Audio u tekst uzivo</h3>
		  <br>
          <!-- Main row -->
          <div class="row">
            <!-- Left col -->
            <section class="col-lg-12 connectedSortable">
              <!-- Custom tabs (Charts with tabs)-->
			  <div id="info">
  <p id="info_start">Kliknite na dugme sa mikrofonom da bi zapoceli snimanje.</p>
  <p id="info_speak_now">Pricajte sada.</p>
  <p id="info_no_speech">Nije detektovan govor. Promenite podesavanja
    <a href="//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892">
      mikrofona</a>.</p>
  <p id="info_no_microphone" style="display:none">
    Mikrofon nije pronadjen. Osigurajte da je drajver za mikrofon instaliran i da su
    <a href="//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892">
    podesavanja</a> konfigurisana dobro.</p>
  <p id="info_allow">Kliknite "Allow" da omogucite mikrofon.</p>
  <p id="info_denied">Nema dozvole da se koristi mikrofon.</p>
  <p id="info_blocked">Dozvola da se koristi mikrofon je blokirana. Da bi promenili,
    posetite chrome://settings/contentExceptions#media-stream</p>
  <p id="info_upgrade">Web Speech API nije podrzan u ovom pretrazivacu.
     Azurirajte na <a href="//www.google.com/chrome">Chrome</a>
     verziju 25 ili kasniju.</p>
</div>
<div class="right">
  <button id="start_button" onclick="startButton(event)">
  
  
    <img id="start_img" src="mic.gif" alt="Start"></button>
    

</div>
<div id="results">
<hr>
  <span id="final_span" class="final"></span>
  <span id="interim_span" class="interim"></span>
<br><hr>
</div>
<div class="center">
  <div id="waveform"></div>
</div><br>


<div ng-repeat="r in tackikce track by $index">



	<span id="r+{{$index}}" >*</span>
	<div ng-show="false">{{calculate(r, $index)}}</div>
	

</div>

<br>
<br>
<button type="button" id="play" style="margin-right:3em;" ng-show="showKonacno" ng-click="playMusic()">Play</button><button type="button" id="pause" style="margin-right:3em;" ng-show="showKonacno" ng-click="pause()">Pause</button>


<br><br>
<div ng-if="crtajGrafik" >
 <highchart   id="chart1" config="chartConfig" ></highchart>
 </div>
 <br><br>
			  
		
			  <p>Pretrazite tekst sa svojim parametrima :</p><input ng-model = "searchBy" type="text" style="margin-right:3em"><button onclick="jsrest2()" type="button" margin-right="3em">Pretrazi</button>
			  <hr><br><br>
			  <button type="button" onClick="download()" style="margin-right:3em">Izvezi u .txt</button><button type="button" id="pdf">Izvezi u .pdf</button>
            </section><!-- /.Left col -->
          </div><!-- /.row (main row) -->

        </section><!-- /.content -->
      </div><!-- /.content-wrapper -->
      <footer class="main-footer">
        <div class="pull-right hidden-xs">
          <b>Verzija</b> 1.0
        </div>
        <strong>Copyright &copy; 2018 <a href="http://ftn.uns.ac.rs/">FTN</a>.</strong> All rights reserved.
      </footer>
    </div><!-- ./wrapper -->

    <!-- jQuery 2.1.3 -->
    <script src="plugins/jQuery/jQuery-2.1.3.min.js"></script>
    <!-- jQuery UI 1.11.2 -->
    <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.min.js" type="text/javascript"></script>
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <script>
      $.widget.bridge('uibutton', $.ui.button);
    </script>
    <!-- Bootstrap 3.3.2 JS -->
    <script src="bootstrap/js/bootstrap.min.js" type="text/javascript"></script>    

    <!-- Bootstrap WYSIHTML5 -->
    <script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js" type="text/javascript"></script>
    <!-- iCheck -->
    <!-- Slimscroll -->
    <script src="plugins/slimScroll/jquery.slimscroll.min.js" type="text/javascript"></script>
    <!-- FastClick -->
    <script src='plugins/fastclick/fastclick.min.js'></script>
    <!-- AdminLTE App -->
    <script src="dist/js/app.min.js" type="text/javascript"></script>

    <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
    <script src="dist/js/pages/dashboard.js" type="text/javascript"></script>

    <!-- AdminLTE for demo purposes -->
    <script src="dist/js/demo.js" type="text/javascript"></script>
	
	<script>

showInfo('info_start');
var audio_file = null;
var mediaRecorder = null;
var audioChunks = [];
var create_email = false;
var final_transcript = '';
var recognizing = false;
var ignore_onend;
var start_timestamp;
//var first = 0;
//var flaggg = true;
var timeStampList = [];
if (!('webkitSpeechRecognition' in window)) {
  upgrade();
} else {
  start_button.style.display = 'inline-block';
  var recognition = new webkitSpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.onstart = function() {
    recognizing = true;
    showInfo('info_speak_now');
    start_img.src = 'mic-animate.gif';
  };
  recognition.onerror = function(event) {
    if (event.error == 'no-speech') {
      start_img.src = 'mic.gif';
      showInfo('info_no_speech');
      ignore_onend = true;
    }
    if (event.error == 'audio-capture') {
      start_img.src = 'mic.gif';
      showInfo('info_no_microphone');
      ignore_onend = true;
    }
    if (event.error == 'not-allowed') {
      if (event.timeStamp - start_timestamp < 100) {
        showInfo('info_blocked');
      } else {
        showInfo('info_denied');
      }
      ignore_onend = true;
    }
  };
  recognition.onend = function() {
    recognizing = false;
    if (ignore_onend) {
      return;
    }
    start_img.src = 'mic.gif';
    if (!final_transcript) {
      showInfo('info_start');
      return;
    }
    showInfo('');
    if (window.getSelection) {
      window.getSelection().removeAllRanges();
      var range = document.createRange();
      range.selectNode(document.getElementById('final_span'));
      window.getSelection().addRange(range);
    }
    if (create_email) {
      create_email = false;
      createEmail();
    }
  };
  recognition.onresult = function(event) {
    var interim_transcript = '';
    for (var i = event.resultIndex; i < event.results.length; ++i) {
      if (event.results[i].isFinal) {
          /*if(flaggg==true){
              first = event.timeStamp;
              flaggg=false;}*/
        final_transcript += event.results[i][0].transcript;
		var temp=[];
		var temop = event.results[i][0].transcript.split(' ');
		for(var l = 0;l<temop.length;l++){
			var el = {"word":temop[l]};
			temp.push(el);
		}
        

        dto = {
        	"time":event.timeStamp,
        	"words":temp
        }
        
        timeStampList.push(dto);
        
        console.log("timestamp:"+event.timeStamp+"\n");
        console.log(event.results[i][0].transcript);
        
      } else {
        interim_transcript += event.results[i][0].transcript;
      }
    }
    final_transcript = capitalize(final_transcript);
    final_span.innerHTML = linebreak(final_transcript);
    interim_span.innerHTML = linebreak(interim_transcript);
    if (final_transcript || interim_transcript) {
      showButtons('inline-block');
    }
  };
}
function upgrade() {
  start_button.style.visibility = 'hidden';
  showInfo('info_upgrade');
}
var two_line = /\n\n/g;
var one_line = /\n/g;
function linebreak(s) {
  return s.replace(two_line, '<p></p>').replace(one_line, '<br>');
}
var first_char = /\S/;
function capitalize(s) {
  return s.replace(first_char, function(m) { return m.toUpperCase(); });
}
function createEmail() {
  var n = final_transcript.indexOf('\n');
  if (n < 0 || n >= 80) {
    n = 40 + final_transcript.substring(40).indexOf(' ');
  }
  var subject = encodeURI(final_transcript.substring(0, n));
  var body = encodeURI(final_transcript.substring(n + 1));
  window.location.href = 'mailto:?subject=' + subject + '&body=' + body;
}
function copyButton() {
  if (recognizing) {
    recognizing = false;
    recognition.stop();
  }
  copy_button.style.display = 'none';
  copy_info.style.display = 'inline-block';
  showInfo('');
}
function emailButton() {
  if (recognizing) {
    create_email = true;
    recognizing = false;
    recognition.stop();
  } else {
    createEmail();
  }
  email_button.style.display = 'none';
  email_info.style.display = 'inline-block';
  showInfo('');
}

function jsrest2(){
	angular.element(document.getElementById('plsRadi')).scope().rest2(timeStampList);
}

function startButton(event) {
  if (recognizing) {
    recognition.stop();
  
    console.log("TESTIRAM");
    setTimeout(function(){
    	angular.element(document.getElementById('plsRadi')).scope().saljiRest();
    }, 1000);

    console.log("STOP...");
	mediaRecorder.stop();
	audioBlob = new Blob(audioChunks,{type: 'audio/mp3'});

	/*var arrayBuffer;
	var fileReader = new FileReader();
	fileReader.onload = function() {
		console.log("fileeeeee")
	    arrayBuffer = this.result;
	};
	fileReader.readAsArrayBuffer(audioBlob);*/
	console.log(audioBlob);
	var audioUrl = URL.createObjectURL(audioBlob);
	console.log(audioUrl);
	var audio = new Audio(audioUrl);
	//audio.play();
	file = new File([audioBlob], 'a'+ new Date().getTime() +'.mp3', {type:'audio/mp3'});
	console.log(file);
	
	//audioBlob=[];
	
//flaggg=true;
	angular.element(document.getElementById('plsRadi')).scope().postImage(file);
    
//    sleep(1000);
  //  angular.element(document.getElementById('plsRadi')).scope().saljiRest(); // OVO RADI
   // document.getElementById('start_button_jebem_ti_mater_gluppu').click();   
    //angular.element(document.querySelector('#start_button_jebem_ti_mater_gluppu')).click();
   audioChunks =[];
    //angular.element("#start_button_jebem_ti_mater_gluppu").triggerHandler('click');
    return;
  }

	console.log("RECORDING...");


	
	navigator.mediaDevices.getUserMedia({ audio: true })
	  .then(stream => {
		//  audioChunks=[];
		
		
		
		
	    mediaRecorder = new MediaRecorder(stream);


	    mediaRecorder.onstart = function(event) {
	    	audioChunks=[];
		 }
	    
	    mediaRecorder.start(100);
	    mediaRecorder.ondataavailable = function(e) {
	    	console.log("GRBA PEDERUUUU");
	    	audioChunks.push(e.data);
	    	}

    	
	 
	    
	});
  
  final_transcript = '';
  recognition.lang = 'sr-RS';
  recognition.start();
  ignore_onend = false;
  final_span.innerHTML = '';
  interim_span.innerHTML = '';
  start_img.src = 'mic-slash.gif';
  showInfo('info_allow');
  showButtons('none');
  start_timestamp = event.timeStamp;
}
function showInfo(s) {
  if (s) {
    for (var child = info.firstChild; child; child = child.nextSibling) {
      if (child.style) {
        child.style.display = child.id == s ? 'inline' : 'none';
      }
    }
    info.style.visibility = 'visible';
  } else {
    info.style.visibility = 'hidden';
  }
}
var current_style;
function showButtons(style) {
  if (style == current_style) {
    return;
  }
  current_style = style;
  email_button.style.display = style;
  copy_info.style.display = 'none';
  email_info.style.display = 'none';
}
</script>

<script>
		function playPauseWave()
		{
			var element = document.getElementById("waveform");
			element.playPause();
		}
	</script>


	<script type="text/javascript">
			function download() {
			var filename = "outputTxt.txt";
			var text = $("#final_span").html();
			text = text.replace("<mark>", "");
			text = text.replace("</mark>", "");
		  var element = document.createElement('a');
		  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
		  element.setAttribute('download', filename);

		  element.style.display = 'none';
		  document.body.appendChild(element);

		  element.click();

		  document.body.removeChild(element);
		}
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js" integrity="sha384-CchuzHs077vGtfhGYl9Qtc7Vx64rXBXdIAZIPbItbNyWIRTdG0oYAqki3Ry13Yzu" crossorigin="anonymous"></script>
<script>

var doc = new jsPDF();

$('#pdf').click(function () {
    doc.fromHTML($('#final_span').html(), 15, 15, {
        'width': 170,
    });
    doc.save('sample-file.pdf');
});

</script>

</div>
  </body>
</html>